(()=>{"use strict";const e="http://localhost:9000",t=async function(t,s,n){const o=await fetch(`${e}/api/${s}/section/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(o.ok)return o.json();throw Error("Server request failed.")},s={card:function(e,t,n=null,o=null,c=!1){const a=document.createElement("div");a.setAttribute("data-id",e.id);const i=document.createElement("button");i.innerText="-",i.addEventListener("click",n),i.classList.add("delete_lesson","edit"),c&&i.classList.add("hide");const d=document.createElement("h1");d.innerText=e.title,d.className="lesson_title";const l=document.createElement("div");for(section of(l.className="lesson_material",e.textbook_sections))s.section.display(section,l);const r=document.createElement("button");r.innerText="+",r.classList.add("edit","lesson_add_material"),r.addEventListener("click",o),c&&r.classList.add("hide");const m=document.createElement("div");m.className="lesson_questions";const u=document.createElement("p");u.innerText=e.question_count,u.className="lesson_stat_data";const p=document.createElement("img");p.src="/static/question.svg",p.className="lesson_stat_image";const _=document.createElement("div");_.className="lesson_words";const g=null==e.notebook_words?-1:e.notebook_words,f=document.createElement("p");f.innerText=g,f.className="lesson_stat_data";const E=document.createElement("img");E.src="/static/question.svg",E.className="lesson_stat_image";const y=document.createElement("div");y.className="lesson_stats",m.append(p,u),_.append(E,f),y.append(m,_),a.append(i,d,l,r,y),t.append(a)},section:{textbook:function(e,t){section_img=document.createElement("img"),section_img.src="/static/textbook.svg",section_img.className="section_img",section_text=document.createElement("div"),section_text.className="section_text",section_title=document.createElement("h3"),section_title.className="section_title",section_title.innerText=e.title,section_pages=document.createElement("p"),section_pages.className="section_pages",section_pages.innerText=`pg. ${e.start_page}-${e.end_page}`,section_text.append(section_title,section_pages),root.append(section_img,section_text)}}},n=function(e,t,s){const n=document.createElement("div");n.className="card",n.setAttribute("data-id",e.id);const o=document.createElement("img");o.src=null==e.filename?"/static/textbook_red.svg":"/static/textbook.svg";const c=document.createElement("div");c.className="text";const a=document.createElement("h3");a.className="title",a.innerText=e.title;const i=document.createElement("p");i.className="author",i.innerText=e.author;const d=document.createElement("p");d.className="pages",d.innerText=`${e.pages}pg`;const l=document.createElement("img");l.className="settings",l.addEventListener("click",s),c.append(a,i),n.append(o,c,d),t.append(n)},o=function(e,t){const s=document.createElement("option");s.value=e.id,s.innerText=e.title,t.append(s)},c=(URL=window.location.pathname,URL=URL.split("/"),URL=URL[2],URL),a={material:{display:document.getElementById("materials"),form:document.getElementById("material_form"),success:document.querySelector("#material_form .success"),failure:document.querySelector("#material_form .failure"),select:document.getElementById("material_select"),empty:document.getElementById("materials_empty"),cards:document.getElementById("material_cards"),add:document.getElementById("add_material")},lesson:{display:document.getElementById("lessons"),empty:document.getElementById("lessons_empty"),add:document.getElementById("add_lesson"),form:document.getElementById("material_section"),cards:document.getElementById("lesson_cards")},modify:document.getElementById("modify"),done:document.getElementById("done"),delete:document.getElementById("delete"),finish:document.getElementById("finish"),course:{title:document.getElementById("course_title"),created:document.getElementById("course_timestamp"),description:document.querySelector("#course_description div")},popup:document.getElementsByClassName("pop_up"),edit:document.getElementsByClassName("edit")};function i(){const e=this.parentElement,t=lesson.dataset.id;lesson.delete(c,t).then((()=>{e.remove()})).catch((e=>{console.log(error)}))}function d(){for(const e of a.edit)e.classList.toggle("hide")}function l(){a.lesson.form.setAttribute("data-id",this.parentElement.dataset.id),a.lesson.form.classList.remove("hide"),a.material.form.classList.add("hide")}d(),function(){for(const e of a.popup)e.classList.toggle("hide")}(),fetch(`${e}/api/website/course/${c}`,{method:"GET",credentials:"include"}).then((e=>{if(e.ok)return e.json()})).then((e=>{const t=e.lessons,c=e.goals,d=e.textbooks;e.course,0===t.length&&0===c.length&&0===d.length&&modify_button.click(),0===t.length||(lessons_empty.style.display="none"),function(e){a.course.title.innerText=null==e.course.title?"Untitled":e.course.title,a.course.innerText=e.course.created,a.course.description.innerText=e.course.description;for(const t of e.lessons)s.card(t,a.lesson.cards,i,l,!a.modify.classList.contains("hide"));for(const t of e.textbooks)n(t,a.material.cards),o(t,a.material.select)}(e)})),a.lesson.add.addEventListener("submit",(t=>{t.preventDefault();const s=new FormData(void 0);(async function(t,s){const n=await fetch(`${e}/api/course/${s}/lesson`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(n.ok)return n.json();throw Error("Server request failed.")})({title:""==s.get("title")?"Untitled":s.get("title")},c).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})),a.lesson.form.addEventListener("submit",(e=>{e.preventDefault(),lesson_id=material_section.dataset.id;var n=new FormData(material_section);payload={textbook_id:n.get("textbook"),lesson_id,start_page:n.get("start_page"),end_page:n.get("end_page")},t(payload,c,lesson_id).then((e=>{lesson_material=document.querySelector(`div[data-id=${lesson_id}] .lesson_material`),s.card(e,lesson_material,i)})).catch((e=>{console.log(error)}))})),a.done.addEventListener("click",(()=>{document.querySelector("#modify").classList.remove("hide"),d()})),a.modify.addEventListener("click",(()=>{a.material.form.classList.remove("hide"),a.material.success.classList.add("hide"),a.material.success.classList.add("hide"),a.lesson.material_section.add("hide")})),a.modify.addEventListener("click",(()=>{a.modify.classList.add("hide"),d()})),a.done.addEventListener("click",(()=>{a.modify.classList.remove("hide"),d()}))})();