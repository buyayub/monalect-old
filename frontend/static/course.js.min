const t="http://localhost:9000",s=(URL=window.location.pathname,URL=URL.split("/"),URL=URL[2],URL);function e(){for(element of website.edit)element.classList.toggle("hide")}website={material:{display:document.getElementById("materials"),form:document.getElementById("material_form"),success:document.querySelector("#material_form .success"),failure:document.querySelector("#material_form .failure"),select:document.getElementById("material_select"),empty:document.getElementById("materials_empty"),cards:document.getElementById("material_cards"),add:document.getElementById("add_material")},lesson:{display:document.getElementById("lessons"),empty:document.getElementById("lessons_empty"),add:document.getElementById("add_lesson"),form:document.getElementById("material_section"),cards:document.getElementById("lesson_cards")},modify:document.getElementById("modify"),done:document.getElementById("done"),delete:document.getElementById("delete"),finish:document.getElementById("finish"),course:{title:document.getElementById("course_title"),created:document.getElementById("course_timestamp"),description:document.querySelector("#course_description div")},popup:document.getElementsByClassName("pop_up"),edit:document.getElementsByClassName("edit")},lesson={display:function(e,t){card=document.createElement("div"),card.setAttribute("data-id",e.id);const s=document.createElement("button"),a=(s.innerText="-",s.addEventListener("click",r),s.classList.add("delete_lesson","edit"),website.modify.classList.contains("hide")||s.classList.add("hide"),document.createElement("h2")),i=(a.innerText=e.title,a.className="lesson_title",document.createElement("div"));i.className="lesson_material";for(section of e.textbook_sections)lesson.section.display(section,i);add_material=document.createElement("button"),add_material.innerText="+",add_material.classList.add("edit","lesson_add_material"),add_material.addEventListener("click",lesson.section.showForm),website.modify.classList.contains("hide")||add_material.classList.add("hide");const n=document.createElement("div"),o=(n.className="lesson_questions",document.createElement("p")),l=(o.innerText=e.question_count,o.className="lesson_stat_data",document.createElement("img")),d=(l.src="/static/question.svg",l.className="lesson_stat_image",document.createElement("div"));d.className="lesson_words",words=null==e.notebook_words?0:e.notebook_words,words_stat=document.createElement("p"),words_stat.innerText=words,words_stat.className="lesson_stat_data",words_image=document.createElement("img"),words_image.src="/static/question.svg",words_image.className="lesson_stat_image",stats=document.createElement("div"),stats.className="lesson_stats",n.append(l,o),d.append(words_image,words_stat),stats.append(n,d),card.append(s,a,i,add_material,stats),t.append(card)},section:{showForm:function(){website.lesson.form.setAttribute("data-id",this.parentElement.dataset.id),website.lesson.form.classList.remove("hide"),website.material.form.classList.add("hide")}}},e();for(element of website.popup)element.classList.toggle("hide");function r(){lesson=this.parentElement,lesson_id=lesson.dataset.id,fetch(t+`/api/course/${s}/lesson/`+lesson_id,{method:"DELETE",credentials:"include"}).then(e=>{e.ok&&lesson.remove()})}function a(){textbook=this.parentElement.parentElement,textbook_id=textbook.dataset.id,fetch(t+`/api/course/${s}/textbook`,{method:"DELETE",credentials:"include"}).then(e=>{e.ok&&textbook.remove()})}function i(){material_settings=document.createElement("div"),material_settings.className("settings"),delete_material=document.createElement("p"),delete_material.className("settings_delete"),delete_material.addEventListener("click",a),material_settings.attach(delete_material)}function n(e,t){textbook_option=document.createElement("option"),textbook_option.value=e.id,textbook_option.innerText=e.title,t.append(textbook_option)}function o(e,t){material_card=document.createElement("div"),material_card.className="material_card",material_card.setAttribute("data-id",e.id),material_image=document.createElement("img"),material_image.src=null==e.filename?"/static/textbook_red.svg":"/static/textbook.svg",material_text=document.createElement("div"),material_text.className="material_text",material_title=document.createElement("h3"),material_title.className="material_title",material_title.innerText=e.title,material_author=document.createElement("p"),material_author.className="material_author",material_author.innerText=e.author,material_pages=document.createElement("p"),material_pages.className="material_pages",material_pages.innerText=e.pages+"pg",material_settings=document.createElement("img"),material_settings.className="material_settings",material_settings.addEventListener("click",i),material_text.append(material_title,material_author),material_card.append(material_image,material_text,material_pages),t.append(material_card)}fetch(t+"/api/website/course/"+s,{method:"GET",credentials:"include"}).then(e=>{if(e.ok)return e.json()}).then(e=>{lessons=e.lessons,goals=e.goals,textbooks=e.textbooks,course=e.course,0===lessons.length&&0===goals.length&&0===textbooks.length&&modify_button.click(),0===lessons.length||(lessons_empty.style.display="none");website.course.title.innerText=null==e.course.title?"Untitled":e.course.title,website.course.innerText=e.course.created,website.course.description.innerText=e.course.description;for(element of e.lessons)lesson.display(element,website.lesson.cards);for(textbook of e.textbooks)o(textbook,website.material.cards),n(textbook,website.material.select)}),website.modify.addEventListener("click",()=>{website.modify.classList.add("hide"),e()}),document.querySelector("#done").addEventListener("click",()=>{document.querySelector("#modify").classList.remove("hide"),e()}),add_lesson.addEventListener("submit",e=>{e.preventDefault();e=new FormData(add_lesson);""===e.get("title")&&e.set("title","Untitled"),lesson_data={title:e.get("title")},fetch(t+`/api/course/${s}/lesson`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(lesson_data)}).then(e=>{if(e.ok)return e.json()}).then(e=>{displayLesson({id:e.id,title:e.title,textbook_sections:[],notebook_words:0,question_count:0},website.lesson.cards)})}),document.querySelector("#add_material").addEventListener("click",()=>{document.querySelector("#material_form").classList.remove("hide"),document.querySelector("#material_form .success").classList.add("hide"),document.querySelector("#material_form .failure").classList.add("hide"),document.querySelector("#material_section").classList.add("hide")}),material_form=document.querySelector("#material_form"),material_form.addEventListener("submit",e=>{e.preventDefault();e=new FormData(material_form);request=new XMLHttpRequest,request.open("POST",t+`/api/${s}/textbook`),request.responseType="json",request.withCredentials=!0,request.onload=()=>{201==request.status?(material_form.reset(),website.material.failure.add("hide"),website.material.success.remove("hide"),o(request.response,website.material.cards),n(request.response)):(website.material.failure.remove("hide"),website.material.success.add("hide"))},request.send(e)}),website.lesson.form.addEventListener("submit",e=>{e.preventDefault(),lesson_id=material_section.dataset.id;e=new FormData(material_section);payload={textbook_id:e.get("textbook"),lesson_id:lesson_id,start_page:e.get("start_page"),end_page:e.get("end_page")},fetch(t+`/api/${s}/section/`+lesson_id,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(payload)}).then(e=>{if(e.ok)return e.json()}).then(e=>{var t;lesson_material=document.querySelector(`div[data-id=${lesson_id}] .lesson_material`),e=e,t=lesson_material,section_img=document.createElement("img"),section_img.src="/static/textbook.svg",section_img.className="section_img",section_text=document.createElement("div"),section_text.className="section_text",section_title=document.createElement("h3"),section_title.className="section_title",section_title.innerText=e.title,section_pages=document.createElement("p"),section_pages.className="section_pages",section_pages.innerText=`pg. ${e.start_page}-`+e.end_page,section_text.append(section_title,section_pages),t.append(section_img,section_text)})});
