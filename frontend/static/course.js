(()=>{const e="http://localhost:9000",t=(URL=window.location.pathname,URL=URL.split("/"),URL=URL[2],URL);function a(){for(element of website.edit)element.classList.toggle("hide")}function s(){textbook=this.parentElement.parentElement,textbook_id=textbook.dataset.id,fetch(`${e}/api/course/${t}/textbook`,{method:"DELETE",credentials:"include"}).then((e=>{e.ok&&textbook.remove()}))}function i(){material_settings=document.createElement("div"),material_settings.className("settings"),delete_material=document.createElement("p"),delete_material.className("settings_delete"),delete_material.addEventListener("click",s),material_settings.attach(delete_material)}function n(e,t){textbook_option=document.createElement("option"),textbook_option.value=e.id,textbook_option.innerText=e.title,t.append(textbook_option)}function o(e,t){material_card=document.createElement("div"),material_card.className="material_card",material_card.setAttribute("data-id",e.id),material_image=document.createElement("img"),material_image.src=null==e.filename?"/static/textbook_red.svg":"/static/textbook.svg",material_text=document.createElement("div"),material_text.className="material_text",material_title=document.createElement("h3"),material_title.className="material_title",material_title.innerText=e.title,material_author=document.createElement("p"),material_author.className="material_author",material_author.innerText=e.author,material_pages=document.createElement("p"),material_pages.className="material_pages",material_pages.innerText=`${e.pages}pg`,material_settings=document.createElement("img"),material_settings.className="material_settings",material_settings.addEventListener("click",i),material_text.append(material_title,material_author),material_card.append(material_image,material_text,material_pages),t.append(material_card)}website={material:{display:document.getElementById("materials"),form:document.getElementById("material_form"),success:document.querySelector("#material_form .success"),failure:document.querySelector("#material_form .failure"),select:document.getElementById("material_select"),empty:document.getElementById("materials_empty"),cards:document.getElementById("material_cards"),add:document.getElementById("add_material")},lesson:{display:document.getElementById("lessons"),empty:document.getElementById("lessons_empty"),add:document.getElementById("add_lesson"),form:document.getElementById("material_section"),cards:document.getElementById("lesson_cards")},modify:document.getElementById("modify"),done:document.getElementById("done"),delete:document.getElementById("delete"),finish:document.getElementById("finish"),course:{title:document.getElementById("course_title"),created:document.getElementById("course_timestamp"),description:document.querySelector("#course_description div")},popup:document.getElementsByClassName("pop_up"),edit:document.getElementsByClassName("edit")},a(),function(){for(element of website.popup)element.classList.toggle("hide")}(),fetch(`${e}/api/website/course/${t}`,{method:"GET",credentials:"include"}).then((e=>{if(e.ok)return e.json()})).then((e=>{lessons=e.lessons,goals=e.goals,textbooks=e.textbooks,course=e.course,0===lessons.length&&0===goals.length&&0===textbooks.length&&modify_button.click(),0===lessons.length||(lessons_empty.style.display="none"),function(e){for(element of(website.course.title.innerText=null==e.course.title?"Untitled":e.course.title,website.course.innerText=e.course.created,website.course.description.innerText=e.course.description,e.lessons))lesson.display(element,website.lesson.cards);for(textbook of e.textbooks)o(textbook,website.material.cards),n(textbook,website.material.select)}(e)})),website.modify.addEventListener("click",(()=>{website.modify.classList.add("hide"),a()})),website.done.addEventListener("click",(()=>{document.querySelector("#modify").classList.remove("hide"),a()})),add_lesson.addEventListener("submit",(a=>{a.preventDefault();var s=new FormData(add_lesson);""===s.get("title")&&s.set("title","Untitled"),lesson_data={title:s.get("title")},fetch(`${e}/api/course/${t}/lesson`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(lesson_data)}).then((e=>{if(e.ok)return e.json()})).then((e=>{displayLesson({id:e.id,title:e.title,textbook_sections:[],notebook_words:0,question_count:0},website.lesson.cards)}))})),website.modify.addEventListener("click",(()=>{website.material.form.classList.remove("hide"),website.material.success.classList.add("hide"),website.material.success.classList.add("hide"),website.lesson.material_section.add("hide")})),material_form=document.querySelector("#material_form"),material_form.addEventListener("submit",(a=>{a.preventDefault();var s=new FormData(material_form);request=new XMLHttpRequest,request.open("POST",`${e}/api/${t}/textbook`),request.responseType="json",request.withCredentials=!0,request.onload=()=>{201==request.status?(material_form.reset(),website.material.failure.add("hide"),website.material.success.remove("hide"),o(request.response,website.material.cards),n(request.response)):(website.material.failure.remove("hide"),website.material.success.add("hide"))},request.send(s)})),website.lesson.form.addEventListener("submit",(a=>{a.preventDefault(),lesson_id=material_section.dataset.id;var s=new FormData(material_section);payload={textbook_id:s.get("textbook"),lesson_id,start_page:s.get("start_page"),end_page:s.get("end_page")},fetch(`${e}/api/${t}/section/${lesson_id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(payload)}).then((e=>{if(e.ok)return e.json()})).then((e=>{lesson_material=document.querySelector(`div[data-id=${lesson_id}] .lesson_material`),function(e,t){section_img=document.createElement("img"),section_img.src="/static/textbook.svg",section_img.className="section_img",section_text=document.createElement("div"),section_text.className="section_text",section_title=document.createElement("h3"),section_title.className="section_title",section_title.innerText=e.title,section_pages=document.createElement("p"),section_pages.className="section_pages",section_pages.innerText=`pg. ${e.start_page}-${e.end_page}`,section_text.append(section_title,section_pages),t.append(section_img,section_text)}(e,lesson_material)}))}))})();